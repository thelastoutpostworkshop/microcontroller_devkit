const M=(()=>{var t=globalThis.document?.currentScript?.src;return async function(m={}){var _,r=m,F=!!globalThis.window,g=!!globalThis.WorkerGlobalScope;globalThis.process?.versions?.node&&globalThis.process?.type!="renderer";var R=(e,n)=>{throw n};g&&(t=self.location.href);var v="";function i(e){return r.locateFile?r.locateFile(e,v):v+e}var s,a;if(F||g){try{v=new URL(".",t).href}catch{}g&&(a=e=>{var n=new XMLHttpRequest;return n.open("GET",e,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),s=async e=>{var n=await fetch(e,{credentials:"same-origin"});if(n.ok)return n.arrayBuffer();throw new Error(n.status+" : "+n.url)}}var o=console.log.bind(console),l=console.error.bind(console),w,p=!1,S,b,I,P,k,L=!1;function W(){var e=B.buffer;r.HEAPU8=P=new Uint8Array(e),r.HEAP32=new Int32Array(e),r.HEAPU32=k=new Uint32Array(e),new BigInt64Array(e),new BigUint64Array(e)}function ae(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)ye(r.preRun.shift());O(K)}function se(){L=!0,T.i()}function oe(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)de(r.postRun.shift());O(j)}function $(e){r.onAbort?.(e),e="Aborted("+e+")",l(e),p=!0,e+=". Build with -sASSERTIONS for more info.";var n=new WebAssembly.RuntimeError(e);throw I?.(n),n}var C;function le(){return i("littlefs.wasm")}function fe(e){if(e==C&&w)return new Uint8Array(w);if(a)return a(e);throw"both async and sync fetching of the wasm failed"}async function ce(e){if(!w)try{var n=await s(e);return new Uint8Array(n)}catch{}return fe(e)}async function _e(e,n){try{var f=await ce(e),h=await WebAssembly.instantiate(f,n);return h}catch(u){l(`failed to asynchronously prepare wasm: ${u}`),$(u)}}async function me(e,n,f){if(!e)try{var h=fetch(n,{credentials:"same-origin"}),u=await WebAssembly.instantiateStreaming(h,f);return u}catch(d){l(`wasm streaming compile failed: ${d}`),l("falling back to ArrayBuffer instantiation")}return _e(n,f)}function ue(){var e={a:Ce};return e}async function we(){function e(d,y){return T=d.exports,$e(T),W(),T}function n(d){return e(d.instance)}var f=ue();if(r.instantiateWasm)return new Promise((d,y)=>{r.instantiateWasm(f,(U,A)=>{d(e(U))})});C??=le();var h=await me(w,C,f),u=n(h);return u}class V{name="ExitStatus";constructor(n){this.message=`Program terminated with exit(${n})`,this.status=n}}var O=e=>{for(;e.length>0;)e.shift()(r)},j=[],de=e=>j.push(e),K=[],ye=e=>K.push(e),z=!0,X=globalThis.TextDecoder&&new TextDecoder,ve=(e,n,f,h)=>{for(var u=n+f;e[n]&&!(n>=u);)++n;return n},q=(e,n=0,f,h)=>{var u=ve(e,n,f);if(u-n>16&&e.buffer&&X)return X.decode(e.subarray(n,u));for(var d="";n<u;){var y=e[n++];if(!(y&128)){d+=String.fromCharCode(y);continue}var U=e[n++]&63;if((y&224)==192){d+=String.fromCharCode((y&31)<<6|U);continue}var A=e[n++]&63;if((y&240)==224?y=(y&15)<<12|U<<6|A:y=(y&7)<<18|U<<12|A<<6|e[n++]&63,y<65536)d+=String.fromCharCode(y);else{var Y=y-65536;d+=String.fromCharCode(55296|Y>>10,56320|Y&1023)}}return d},H=(e,n,f)=>e?q(P,e,n):"",he=(e,n,f,h)=>$(`Assertion failed: ${H(e)}, at: `+[n?H(n):"unknown filename",f,h?H(h):"unknown function"]),ge=()=>$(""),x=0,pe=()=>{z=!1,x=0},E={},Z=e=>{if(e instanceof V||e=="unwind")return S;R(1,e)},G=()=>z||x>0,J=e=>{S=e,G()||(r.onExit?.(e),p=!0),R(e,new V(e))},Fe=(e,n)=>{S=e,J(e)},Se=Fe,Re=()=>{if(!G())try{Se(S)}catch(e){Z(e)}},be=e=>{if(!p)try{e(),Re()}catch(n){Z(n)}},Ue=()=>performance.now(),Ae=(e,n)=>{if(E[e]&&(clearTimeout(E[e].id),delete E[e]),!n)return 0;var f=setTimeout(()=>{delete E[e],be(()=>Q(e,Ue()))},n);return E[e]={id:f,timeout_ms:n},0},Pe=()=>67108864,ke=(e,n)=>Math.ceil(e/n)*n,Le=e=>{var n=B.buffer.byteLength,f=(e-n+65535)/65536|0;try{return B.grow(f),W(),1}catch{}},Ee=e=>{var n=P.length;e>>>=0;var f=Pe();if(e>f)return!1;for(var h=1;h<=4;h*=2){var u=n*(1+.2/h);u=Math.min(u,e+100663296);var d=Math.min(f,ke(Math.max(e,u),65536)),y=Le(d);if(y)return!0}return!1},Te=[null,[],[]],Ie=(e,n)=>{var f=Te[e];n===0||n===10?((e===1?o:l)(q(f)),f.length=0):f.push(n)},Be=(e,n,f,h)=>{for(var u=0,d=0;d<f;d++){var y=k[n>>2],U=k[n+4>>2];n+=8;for(var A=0;A<U;A++)Ie(e,P[y+A]);u+=U}return k[h>>2]=u,0};if(r.noExitRuntime&&(z=r.noExitRuntime),r.print&&(o=r.print),r.printErr&&(l=r.printErr),r.wasmBinary&&(w=r.wasmBinary),r.arguments&&r.arguments,r.thisProgram&&r.thisProgram,r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.shift()();var Q,B;function $e(e){r._lfs_wasm_set_disk_version=e.j,r._lfs_wasm_get_disk_version=e.k,r._lfs_wasm_init=e.l,r._free=e.m,r._malloc=e.n,r._lfs_wasm_init_from_image=e.o,r._lfs_wasm_get_fs_info=e.p,r._lfs_wasm_mount=e.q,r._lfs_wasm_unmount=e.r,r._lfs_wasm_format=e.s,r._lfs_wasm_mkdir=e.t,r._lfs_wasm_remove=e.u,r._lfs_wasm_rename=e.v,r._lfs_wasm_stat=e.w,r._lfs_wasm_dir_open=e.x,r._lfs_wasm_dir_read=e.y,r._lfs_wasm_dir_close=e.z,r._lfs_wasm_write_file=e.A,r._lfs_wasm_read_file=e.B,r._lfs_wasm_file_size=e.C,r._lfs_wasm_get_image=e.D,r._lfs_wasm_get_image_size=e.E,r._lfs_wasm_fs_stat=e.F,r._lfs_wasm_cleanup=e.G,Q=e.H,B=e.h,e.__indirect_function_table}var Ce={a:he,d:ge,c:pe,e:Ae,f:Ee,g:Be,b:J};function ze(){ae();function e(){r.calledRun=!0,!p&&(se(),b?.(r),r.onRuntimeInitialized?.(),oe())}r.setStatus?(r.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>r.setStatus(""),1),e()},1)):e()}var T;return T=await we(),ze(),L?_=r:_=new Promise((e,n)=>{b=e,I=n}),_}})();typeof exports=="object"&&typeof module=="object"?(module.exports=createLittleFS,module.exports.default=createLittleFS):typeof define=="function"&&define.amd&&define([],()=>createLittleFS);const ee=4096,He=256,te=32,De=-28,D=64,re=131072,Ne=131073;function N(t){const m=t>>16&65535,_=t&65535;return`${m}.${_}`}class c extends Error{constructor(m,_){super(m),this.code=_,this.name="LittleFSError"}}function ne(t){const m=t instanceof URL?t.href:t;return{locateFile:_=>_.endsWith(".wasm")?(console.info("[littlefs-wasm] locateFile:",_,"->",m),m):_}}async function We(t={}){console.info("[littlefs-wasm] createLittleFS() starting",t);const m=t.blockSize??ee,_=t.blockCount??He,r=t.lookaheadSize??te,F=t.diskVersion??re,g=t.wasmURL??new URL(""+new URL("littlefs-DjqzvU0S.wasm",import.meta.url).href,import.meta.url).href,R=ne(g),v=await M(R);console.info("[littlefs-wasm] Emscripten module loaded");try{v._lfs_wasm_set_disk_version&&(v._lfs_wasm_set_disk_version(F),console.info("[littlefs-wasm] Disk version set to:",N(F)));const i=v._lfs_wasm_init(m,_,r);if(i!==0)throw new c(`Failed to initialize LittleFS: ${i}`,i);if(t.formatOnInit){const a=v._lfs_wasm_format();if(a!==0)throw new c(`Failed to format LittleFS: ${a}`,a)}const s=v._lfs_wasm_mount();if(s!==0){if(t.autoFormatOnMountFailure!==!0)throw new c(`Failed to mount LittleFS: ${s}`,s);console.warn("[littlefs-wasm] Mount failed, attempting format and remount...");const a=v._lfs_wasm_format();if(a!==0)throw new c(`Failed to format LittleFS: ${a}`,a);const o=v._lfs_wasm_mount();if(o!==0)throw new c(`Failed to mount LittleFS: ${o}`,o)}}catch(i){if(v._lfs_wasm_cleanup)try{v._lfs_wasm_cleanup()}catch(s){console.error("[littlefs-wasm] Cleanup during error handling failed:",s)}throw i}return console.info("[littlefs-wasm] LittleFS mounted successfully"),ie(v,m,_)}async function Ve(t,m={}){console.info("[littlefs-wasm] createLittleFSFromImage() starting");const _=t instanceof ArrayBuffer?new Uint8Array(t):t,r=m.blockSize??ee,F=m.blockCount??Math.ceil(_.length/r),g=m.lookaheadSize??te,R=m.wasmURL??new URL(""+new URL("littlefs-DjqzvU0S.wasm",import.meta.url).href,import.meta.url).href,v=ne(R),i=await M(v);console.info("[littlefs-wasm] Emscripten module loaded");try{const a=i._malloc(_.length);if(!a)throw new c("Failed to allocate memory for image",-1);try{i.HEAPU8.set(_,a);const l=i._lfs_wasm_init_from_image(a,_.length,r,F,g);if(l!==0)throw new c(`Failed to initialize LittleFS from image: ${l}`,l)}finally{i._free(a)}const o=i._lfs_wasm_mount();if(o!==0)throw new c(`Failed to mount LittleFS: ${o}`,o)}catch(a){if(i._lfs_wasm_cleanup)try{i._lfs_wasm_cleanup()}catch(o){console.error("[littlefs-wasm] Cleanup during error handling failed:",o)}throw a}const s=i._lfs_wasm_get_disk_version?i._lfs_wasm_get_disk_version():0;return console.info("[littlefs-wasm] LittleFS mounted from image, disk version:",N(s)),ie(i,r,F)}function ie(t,m,_){const r=new TextEncoder,F=new TextDecoder;function g(i){const s=r.encode(i+"\0"),a=t._malloc(s.length);if(!a)throw new c("Failed to allocate string",-1);return t.HEAPU8.set(s,a),a}function R(i,s=4096){if(!i)return"";let a=i;const o=i+s;for(;a<o&&t.HEAPU8[a]!==0;)a++;return a>=o&&console.warn("[littlefs-wasm] String read truncated at maxLength"),F.decode(t.HEAPU8.subarray(i,a))}return{format(){const i=t._lfs_wasm_format();if(i!==0)throw new c(`Format failed: ${i}`,i);const s=t._lfs_wasm_mount();if(s!==0)throw new c(`Mount after format failed: ${s}`,s)},list(i="/"){const s=[],a=g(i);let o=-1;try{if(o=t._lfs_wasm_dir_open(a),o<0)throw new c(`Failed to open directory: ${o}`,o);const l=t._malloc(D+1),w=t._malloc(4),p=t._malloc(4);try{for(;;){const S=t._lfs_wasm_dir_read(o,l,D,w,p);if(S===0)break;if(S<0)throw new c(`Failed to read directory: ${S}`,S);const b=R(l);if(b==="."||b==="..")continue;const I=t.HEAP32[w>>2],P=t.HEAPU32[p>>2],k=i==="/"?`/${b}`:`${i}/${b}`,L=I===2;s.push({path:k,name:b,size:L?0:P,type:L?"dir":"file"})}}finally{t._free(l),t._free(w),t._free(p)}t._lfs_wasm_dir_close(o),o=-1}finally{t._free(a),o>=0&&t._lfs_wasm_dir_close(o)}return s},readFile(i){const s=g(i);try{const a=t._lfs_wasm_file_size(s);if(a<0)throw new c(`Failed to get file size: ${a}`,a);const o=t._malloc(a);if(!o&&a>0)throw new c("Failed to allocate read buffer",-1);try{const l=t._lfs_wasm_read_file(s,o,a);if(l<0)throw new c(`Failed to read file: ${l}`,l);return new Uint8Array(t.HEAPU8.buffer,o,l).slice()}finally{t._free(o)}}finally{t._free(s)}},writeFile(i,s){const a=g(i),o=s instanceof Uint8Array?s:new Uint8Array(s),l=t._malloc(o.length);if(!l&&o.length>0)throw t._free(a),new c("Failed to allocate write buffer",-1);try{t.HEAPU8.set(o,l);const w=t._lfs_wasm_write_file(a,l,o.length);if(w<0)throw w===De?new c("No space left on device",w):new c(`Failed to write file: ${w}`,w)}finally{t._free(a),t._free(l)}},addFile(i,s){return this.writeFile(i,s)},deleteFile(i){const s=g(i);try{const a=t._lfs_wasm_remove(s);if(a!==0)throw new c(`Failed to delete: ${a}`,a)}finally{t._free(s)}},delete(i,s={}){if(s.recursive)try{const a=this.list(i);for(const o of a)o.type==="dir"?this.delete(o.path,{recursive:!0}):this.deleteFile(o.path)}catch(a){a.code!==-2&&console.warn("[littlefs-wasm] Error during recursive delete:",a)}this.deleteFile(i)},mkdir(i){const s=g(i);try{const a=t._lfs_wasm_mkdir(s);if(a!==0&&a!==-17)throw new c(`Failed to create directory: ${a}`,a)}finally{t._free(s)}},rename(i,s){const a=g(i),o=g(s);try{const l=t._lfs_wasm_rename(a,o);if(l!==0)throw new c(`Failed to rename: ${l}`,l)}finally{t._free(a),t._free(o)}},toImage(){const i=t._lfs_wasm_get_image_size();if(i<=0)throw new c(`Invalid image size: ${i}`,i);const s=t._lfs_wasm_get_image();if(!s)throw new c("Failed to get image pointer",-1);return new Uint8Array(t.HEAPU8.buffer,s,i).slice()},getDiskVersion(){if(t._lfs_wasm_get_fs_info){const i=t._malloc(4);try{if(t._lfs_wasm_get_fs_info(i)===0)return t.HEAPU32[i>>2]}finally{t._free(i)}}return console.warn("[littlefs-wasm] getDiskVersion not available or filesystem not mounted"),0},setDiskVersion(i){t._lfs_wasm_set_disk_version?t._lfs_wasm_set_disk_version(i):console.warn("[littlefs-wasm] setDiskVersion not available")},getUsage(){const i=t._malloc(4),s=t._malloc(4);try{if(t._lfs_wasm_fs_stat(i,s)!==0)return{capacityBytes:m*_,usedBytes:0,freeBytes:m*_};const o=t.HEAPU32[i>>2],w=t.HEAPU32[s>>2]*m,p=o*m;return{capacityBytes:w,usedBytes:p,freeBytes:Math.max(0,w-p)}}finally{t._free(i),t._free(s)}},canFit(i,s){return this.getUsage().freeBytes>=s},cleanup(){t._lfs_wasm_unmount(),t._lfs_wasm_cleanup()}}}const Oe={createLittleFS:We,createLittleFSFromImage:Ve,DISK_VERSION_2_0:re,DISK_VERSION_2_1:Ne,LFS_NAME_MAX:D,formatDiskVersion:N};export{re as DISK_VERSION_2_0,Ne as DISK_VERSION_2_1,D as LFS_NAME_MAX,c as LittleFSError,We as createLittleFS,Ve as createLittleFSFromImage,Oe as default,N as formatDiskVersion};
